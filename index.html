<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mangais Golf & Nature</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script>
        window.onerror = function(msg, url, line) {
            document.body.innerHTML = `<div style="color:white;background:red;padding:20px;"><h1>üí• APP CRASHED</h1><p>${msg}</p><p>Line: ${line}</p></div>`;
        };
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style> 
        body { background-color: #022c22; color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-nav { background: rgba(6, 78, 59, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.9); opacity:0; } 100% { transform: scale(1); opacity:1; } }
    </style>
</head>
<body>
    <div id="root" class="h-screen w-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // --- 1. DATA ---
        // The key is injected by the server
        const API_KEY = window.ENV_API_KEY; 

        const COURSE_DATA = [
            { hole: 1, par: 5, si: 16, dist: 473, tip: "Wide fairway üå¥. Good warm up." },
            { hole: 2, par: 4, si: 14, dist: 333, tip: "Watch the bunkers üèñÔ∏è." },
            { hole: 3, par: 4, si: 8, dist: 387, tip: "Dogleg right ‚Ü™Ô∏è. Cut the corner?" },
            { hole: 4, par: 3, si: 12, dist: 206, tip: "Long iron needed üèåÔ∏è‚Äç‚ôÇÔ∏è." },
            { hole: 5, par: 5, si: 2, dist: 500, tip: "Water hazard üíß on second shot." },
            { hole: 6, par: 4, si: 18, dist: 355, tip: "Birdie chance! ü¶Ö Attack the pin." },
            { hole: 7, par: 4, si: 10, dist: 399, tip: "Keep it left ‚¨ÖÔ∏è away from trees." },
            { hole: 8, par: 3, si: 6, dist: 223, tip: "Wind swirls here üå¨Ô∏è." },
            { hole: 9, par: 4, si: 4, dist: 412, tip: "Uphill approach ‚õ∞Ô∏è." },
            { hole: 10, par: 4, si: 3, dist: 384, tip: "Tight fairway. Precision key üéØ." },
            { hole: 11, par: 3, si: 11, dist: 163, tip: "Don't go long üõë." },
            { hole: 12, par: 5, si: 13, dist: 511, tip: "‚ö†Ô∏è CROCODILES RIGHT üêä." },
            { hole: 13, par: 4, si: 9, dist: 382, tip: "Center green is safe üü¢." },
            { hole: 14, par: 4, si: 7, dist: 374, tip: "Kwanza River view üåä." },
            { hole: 15, par: 3, si: 17, dist: 218, tip: "Short but technical üß†." },
            { hole: 16, par: 4, si: 5, dist: 391, tip: "Two tier green üìä." },
            { hole: 17, par: 5, si: 1, dist: 483, tip: "Index 1 üíÄ. Play safe!" },
            { hole: 18, par: 4, si: 15, dist: 324, tip: "Home stretch üè†. Enjoy the view." }
        ];

        const ANIMALS = [
            { name: "Crocodile", emoji: "üêä", pts: 50 },
            { name: "Monkey", emoji: "üêí", pts: 20 },
            { name: "Hippo", emoji: "ü¶õ", pts: 100 },
            { name: "Exotic Bird", emoji: "ü¶ú", pts: 30 },
            { name: "Snake", emoji: "üêç", pts: 40 }
        ];

        // --- 2. AUTHENTICATION (Simulated) ---
        const useAuth = () => {
            const [user, setUser] = useState(null);
            useEffect(() => {
                const saved = localStorage.getItem('mangais_user');
                if (saved) setUser(JSON.parse(saved));
            }, []);
            const login = (email) => {
                const u = { email, name: email.split('@')[0], uid: Date.now() };
                localStorage.setItem('mangais_user', JSON.stringify(u));
                setUser(u);
            };
            const logout = () => {
                localStorage.removeItem('mangais_user');
                setUser(null);
            };
            return { user, login, logout };
        };

        // --- 3. SCORING ---
        const calcStableford = (par, si, shots, hcp) => {
            if (!shots) return 0;
            let free = 0;
            if (hcp >= si) free = 1;
            if (hcp - 18 >= si) free = 2;
            const net = shots - free;
            return Math.max(0, (par - net) + 2);
        };

        // --- 4. APP ---
        function App() {
            const { user, login, logout } = useAuth();
            const [view, setView] = useState('auth');
            const [logs, setLogs] = useState([]);
            const [camera, setCamera] = useState(false);
            
            // Game State
            const [holeIdx, setHoleIdx] = useState(0); // 0-17
            const [scores, setScores] = useState({});
            const [playerHcp, setPlayerHcp] = useState(18);

            useEffect(() => { if (user) setView('home'); else setView('auth'); }, [user]);

            const hole = COURSE_DATA[holeIdx];
            const scoreData = scores[hole.hole] || { shots: hole.par, putts: 2 };

            const updateScore = (type, val) => {
                const current = scores[hole.hole] || { shots: hole.par, putts: 2 };
                const newVal = Math.max(0, current[type] + val);
                setScores({ ...scores, [hole.hole]: { ...current, [type]: newVal } });
            };

            const logAnimal = (animal) => {
                const newLog = { 
                    id: Date.now(), 
                    animal, 
                    hole: hole.hole, 
                    time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
                    user: user.name 
                };
                setLogs([newLog, ...logs]);
                setCamera(false);
                alert(`üì∏ Captured ${animal.name}! +${animal.pts} pts`);
            };

            // --- VIEW: AUTH ---
            if (!user) return (
                <div className="h-full flex flex-col items-center justify-center p-6 bg-gradient-to-br from-green-900 to-black text-center">
                    <div className="text-8xl mb-4 animate-bounce">üêä</div>
                    <h1 className="text-4xl font-black mb-2">MANGAIS</h1>
                    <p className="text-emerald-400 text-xs font-bold tracking-widest uppercase mb-10">Golf & Nature Reserve</p>
                    <div className="w-full max-w-sm space-y-4">
                        <button onClick={() => login('tiger@mangais.com')} className="w-full bg-white text-black py-4 rounded-xl font-bold flex items-center justify-center gap-2 hover:scale-105 transition">
                            <span>üêØ</span> Login as Tiger
                        </button>
                        <button onClick={() => login('guest@mangais.com')} className="w-full glass text-white py-4 rounded-xl font-bold">
                            Guest Access
                        </button>
                    </div>
                </div>
            );

            // --- VIEW: HOME ---
            if (view === 'home') return (
                <div className="h-full flex flex-col p-6 bg-[url('https://images.unsplash.com/photo-1593111774240-d529f12cf4bb?q=80&w=1000')] bg-cover bg-center">
                    <div className="absolute inset-0 bg-black/60"></div>
                    <div className="relative z-10 flex flex-col h-full">
                        <div className="flex justify-between items-center mb-10">
                            <div>
                                <h1 className="text-3xl font-black">Hi, {user.name} üëã</h1>
                                <p className="text-emerald-400 font-bold text-sm">HCP {playerHcp} ‚Ä¢ Eco-Rank: Scout</p>
                            </div>
                            <button onClick={logout} className="p-3 glass rounded-full text-xl">üö™</button>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={() => setView('game')} className="glass p-8 rounded-2xl flex flex-col items-center gap-2 hover:bg-white/10 transition">
                                <span className="text-5xl">‚õ≥</span>
                                <span className="font-bold">Play Golf</span>
                            </button>
                            <button onClick={() => setView('nature')} className="glass p-8 rounded-2xl flex flex-col items-center gap-2 hover:bg-white/10 transition">
                                <span className="text-5xl">üì∏</span>
                                <span className="font-bold">Nature Log</span>
                            </button>
                        </div>
                        <div className="mt-8 glass p-6 rounded-2xl">
                            <h3 className="font-bold text-emerald-300 mb-2">üì¢ Resort Alerts</h3>
                            <p className="text-sm text-gray-200">üêä Croc spotted near Hole 12.</p>
                        </div>
                    </div>
                </div>
            );

            // --- VIEW: NATURE ---
            if (view === 'nature') return (
                <div className="h-full flex flex-col bg-stone-900">
                    <div className="p-4 glass-nav flex items-center justify-between sticky top-0 z-20">
                        <button onClick={() => setView('home')} className="text-2xl">üîô</button>
                        <h2 className="font-black text-emerald-400">NATURE WATCH</h2>
                        <div className="w-8"></div>
                    </div>
                    <div className="flex-1 p-4 overflow-y-auto">
                        <button onClick={() => setCamera(true)} className="w-full bg-emerald-600 py-8 rounded-2xl flex flex-col items-center gap-2 shadow-lg mb-6 active:scale-95 transition">
                            <span className="text-5xl">üì∏</span>
                            <span className="font-bold">LOG SIGHTING</span>
                        </button>
                        <h3 className="font-bold text-gray-500 text-xs uppercase mb-3">Recent Feed</h3>
                        {logs.length === 0 ? <div className="text-center text-gray-600 py-10">No animals seen yet...</div> : 
                            logs.map(log => (
                                <div key={log.id} className="glass p-4 rounded-xl flex gap-4 mb-3 pop">
                                    <div className="w-16 h-16 bg-emerald-900/50 rounded-lg flex items-center justify-center text-3xl">{log.animal.emoji}</div>
                                    <div>
                                        <h4 className="font-bold text-lg">{log.animal.name}</h4>
                                        <p className="text-xs text-emerald-400">Hole {log.hole} ‚Ä¢ {log.user}</p>
                                    </div>
                                </div>
                            ))
                        }
                    </div>
                    {/* CAMERA MODAL */}
                    {camera && (
                        <div className="absolute inset-0 bg-black z-50 flex flex-col p-6">
                            <div className="flex-1 border-2 border-white/30 rounded-3xl relative bg-gray-900 flex items-center justify-center">
                                <div className="text-gray-500">[ Camera View ]</div>
                                <div className="absolute w-40 h-40 border-2 border-yellow-400/50 rounded-lg"></div>
                            </div>
                            <div className="mt-6">
                                <h3 className="text-center font-bold mb-4">What did you see?</h3>
                                <div className="flex gap-2 overflow-x-auto pb-4">
                                    {ANIMALS.map(a => (
                                        <button key={a.name} onClick={() => logAnimal(a)} className="bg-gray-800 p-4 rounded-xl flex flex-col items-center w-24 border border-gray-700">
                                            <span className="text-3xl mb-1">{a.emoji}</span>
                                            <span className="text-xs font-bold">{a.name}</span>
                                        </button>
                                    ))}
                                </div>
                                <button onClick={() => setCamera(false)} className="w-full py-4 text-gray-400 font-bold">Cancel</button>
                            </div>
                        </div>
                    )}
                </div>
            );

            // --- VIEW: GAME ---
            if (view === 'game') return (
                <div className="h-full flex flex-col bg-gray-900">
                    <div className="glass-nav p-4 flex justify-between items-end">
                        <button onClick={() => setView('home')} className="text-xl">üè†</button>
                        <div className="text-center">
                            <h2 className="text-2xl font-black">HOLE {hole.hole}</h2>
                            <p className="text-emerald-400 text-xs font-bold">PAR {hole.par} ‚Ä¢ SI {hole.si}</p>
                        </div>
                        <div className="text-xl font-black text-yellow-400">
                            {calcStableford(hole.par, hole.si, scoreData.shots, playerHcp)} <span className="text-xs">PTS</span>
                        </div>
                    </div>
                    <div className="flex-1 p-6 flex flex-col items-center overflow-y-auto">
                        <div className="bg-emerald-900/40 border border-emerald-500/30 p-4 rounded-xl mb-6 text-center w-full">
                            <p className="text-emerald-100 text-sm italic">"{hole.tip}"</p>
                        </div>
                        
                        {/* BIG SCORE CONTROLS */}
                        <div className="flex items-center gap-6 mb-8">
                            <button onClick={() => updateScore('shots', -1)} className="w-16 h-16 rounded-full glass text-3xl font-bold">-</button>
                            <div className="text-center">
                                <div className="text-9xl font-black leading-none">{scoreData.shots}</div>
                                <div className="text-xs font-bold text-gray-500 uppercase tracking-widest">Strokes</div>
                            </div>
                            <button onClick={() => updateScore('shots', 1)} className="w-16 h-16 rounded-full bg-emerald-500 text-black text-3xl font-bold shadow-lg shadow-emerald-500/50">+</button>
                        </div>
                        
                        {/* PUTTS */}
                        <div className="bg-black/40 rounded-full px-6 py-3 flex items-center gap-6 border border-white/10 mb-8">
                            <span className="text-xs font-bold text-gray-400">PUTTS</span>
                            <button onClick={() => updateScore('putts', -1)} className="text-xl font-bold text-gray-400">-</button>
                            <span className="font-bold text-xl">{scoreData.putts}</span>
                            <button onClick={() => updateScore('putts', 1)} className="text-xl font-bold text-white">+</button>
                        </div>

                        {/* NAV */}
                        <div className="flex gap-4 w-full">
                            <button onClick={() => setView('nature')} className="glass flex-1 py-4 rounded-xl font-bold flex items-center justify-center gap-2">
                                <span>üêä</span> Sighting
                            </button>
                            <button onClick={() => { if(holeIdx < 17) setHoleIdx(holeIdx+1); }} className="bg-white text-black flex-1 py-4 rounded-xl font-bold shadow-lg">
                                Next Hole ‚û°Ô∏è
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
